# ğŸ¨ Melhorias no Cadastro de Clientes

## ğŸ“‹ Resumo das ImplementaÃ§Ãµes

### 1. ğŸŒ Lista Completa de PaÃ­ses
- **104 paÃ­ses** disponÃ­veis no select de paÃ­s
- Organizado por regiÃµes geogrÃ¡ficas
- ExibiÃ§Ã£o com bandeira emoji + nome do paÃ­s
- Inclui cÃ³digo de discagem para cada paÃ­s

**PaÃ­ses incluÃ­dos**:
- AmÃ©rica do Sul (10 paÃ­ses)
- AmÃ©rica do Norte (3 paÃ­ses)
- AmÃ©rica Central e Caribe (5 paÃ­ses)
- Europa Ocidental (12 paÃ­ses)
- Europa do Norte (5 paÃ­ses)
- Europa do Leste (11 paÃ­ses)
- Europa do Sul (3 paÃ­ses)
- Oceania (2 paÃ­ses)
- Ãsia (12 paÃ­ses)
- Oriente MÃ©dio (2 paÃ­ses)
- Ãfrica (5 paÃ­ses)

---

### 2. ğŸ“ IdentificaÃ§Ã£o Fiscal DinÃ¢mica por PaÃ­s

Agora o select de identificaÃ§Ã£o fiscal **muda automaticamente** baseado no paÃ­s selecionado!

#### Exemplos por PaÃ­s:

**ğŸ‡§ğŸ‡· Brasil**
- CNPJ - Cadastro Nacional da Pessoa JurÃ­dica (Empresa)
- CPF - Cadastro de Pessoa FÃ­sica (Individual)

**ğŸ‡ºğŸ‡¸ Estados Unidos**
- EIN - Employer Identification Number (Business)
- SSN - Social Security Number (Individual)

**ğŸ‡ªğŸ‡¸ Espanha**
- NIF - NÃºmero de IdentificaciÃ³n Fiscal (Empresa)
- NIE - NÃºmero de Identidad de Extranjero
- CIF - CÃ³digo de IdentificaciÃ³n Fiscal (Empresa)

**ğŸ‡µğŸ‡¹ Portugal**
- NIPC - NÃºmero de IdentificaÃ§Ã£o de Pessoa Coletiva (Empresa)
- NIF - NÃºmero de IdentificaÃ§Ã£o Fiscal (Individual)

**ğŸ‡®ğŸ‡ª Irlanda**
- VAT Number - Value Added Tax Number (Business)
- PPS Number - Personal Public Service Number (Individual)

**ğŸ‡¬ğŸ‡§ Reino Unido**
- VAT Number - Value Added Tax Number (Business)
- UTR - Unique Taxpayer Reference
- NINO - National Insurance Number (Individual)

**ğŸ‡«ğŸ‡· FranÃ§a**
- SIRET - SystÃ¨me d'Identification du RÃ©pertoire des Ã‰tablissements (Business)
- SIREN - SystÃ¨me d'Identification du RÃ©pertoire des Entreprises (Business)
- TVA - NumÃ©ro de TVA Intracommunautaire

**ğŸ‡®ğŸ‡¹ ItÃ¡lia**
- Partita IVA - Numero di Partita IVA (Business)
- Codice Fiscale - Codice Fiscale (Individual/Business)

**ğŸ‡©ğŸ‡ª Alemanha**
- USt-IdNr - Umsatzsteuer-Identifikationsnummer (VAT)
- Steuernummer - Tax Number

**ğŸ‡¦ğŸ‡· Argentina**
- CUIT - Clave Ãšnica de IdentificaciÃ³n Tributaria (Business)
- CUIL - CÃ³digo Ãšnico de IdentificaciÃ³n Laboral (Individual)

**ğŸ‡²ğŸ‡½ MÃ©xico**
- RFC - Registro Federal de Contribuyentes

**ğŸ‡¨ğŸ‡± Chile**
- RUT - Rol Ãšnico Tributario

**ğŸ‡¨ğŸ‡´ ColÃ´mbia**
- NIT - NÃºmero de IdentificaciÃ³n Tributaria (Business)
- CC - CÃ©dula de CiudadanÃ­a (Individual)

**ğŸ‡¨ğŸ‡¦ CanadÃ¡**
- Business Number (BN)
- SIN - Social Insurance Number (Individual)

**ğŸ‡¦ğŸ‡º AustrÃ¡lia**
- ABN - Australian Business Number
- TFN - Tax File Number (Individual)

**UniÃ£o Europeia e outros**
- VAT Number - Value Added Tax Number (genÃ©rico)

---

### 3. ğŸ“§ MÃºltiplos E-mails

Agora vocÃª pode adicionar **atÃ© 5 e-mails** por cliente!

#### Funcionalidades:
- âœ… Adicionar mÃºltiplos e-mails
- âœ… E-mail principal destacado
- âœ… ValidaÃ§Ã£o automÃ¡tica de formato
- âœ… Previne duplicatas
- âœ… Remover e-mails individualmente
- âœ… Interface intuitiva com botÃ£o "Adicionar"
- âœ… Tecla Enter para adicionar rapidamente

#### Por que mÃºltiplos e-mails?
- ğŸ“¨ **Envio automÃ¡tico de faturas** para vÃ¡rios destinatÃ¡rios
- ğŸ‘¥ **MÃºltiplos contatos** na mesma empresa
- ğŸ”„ **RedundÃ¢ncia** de comunicaÃ§Ã£o
- ğŸ“Š **RelatÃ³rios** enviados para diferentes departamentos

#### Como funciona:
1. Digite o e-mail no campo
2. Clique em "Adicionar" ou pressione Enter
3. O e-mail aparece na lista acima
4. O primeiro e-mail Ã© marcado como "Principal"
5. Para remover, clique no âŒ ao lado do e-mail

---

## ğŸ¨ Interface Melhorada

### OrganizaÃ§Ã£o em SeÃ§Ãµes

O formulÃ¡rio agora estÃ¡ dividido em **4 seÃ§Ãµes** claras:

1. **InformaÃ§Ãµes BÃ¡sicas**
   - Nome Legal
   - Nome Fantasia
   - PaÃ­s
   - Idioma Preferido

2. **IdentificaÃ§Ã£o Fiscal**
   - Tipo de IdentificaÃ§Ã£o (dinÃ¢mico por paÃ­s)
   - NÃºmero de IdentificaÃ§Ã£o

3. **EndereÃ§o**
   - EndereÃ§o completo
   - Cidade
   - Estado/ProvÃ­ncia
   - CEP/CÃ³digo Postal

4. **InformaÃ§Ãµes de Contato**
   - MÃºltiplos E-mails (novo!)
   - Telefone com paÃ­s independente
   - Website

### Design Moderno
- âœ… Cards com bordas e sombras suaves
- âœ… EspaÃ§amento adequado
- âœ… Cores consistentes
- âœ… Ãcones informativos
- âœ… Mensagens de ajuda contextuais

---

## ğŸ—„ï¸ Estrutura de Banco de Dados

### Nova Tabela Customer (completa)

```sql
create table customer (
  id uuid primary key,
  branch_id uuid references branch(id),
  
  -- InformaÃ§Ãµes bÃ¡sicas
  legal_name text not null,
  trade_name text,
  country_code text,
  preferred_language text default 'pt-BR',
  
  -- IdentificaÃ§Ã£o fiscal
  tax_id text,
  tax_id_type tax_id_type,
  
  -- EndereÃ§o
  address text,
  city text,
  state_code text,
  postal_code text,
  
  -- Contato
  phone text,
  phone_country text default 'BR',
  email text,
  emails jsonb default '[]'::jsonb, -- NOVO!
  website text,
  
  -- Metadata
  is_active boolean default true,
  addresses jsonb,
  contacts jsonb,
  default_language text,
  
  created_at timestamptz default now(),
  updated_at timestamptz
);
```

### FunÃ§Ãµes de ValidaÃ§Ã£o

```sql
-- Valida array de e-mails
validate_emails_array(emails_json jsonb) returns boolean

-- ObtÃ©m e-mail principal
get_primary_email(emails_json jsonb) returns text

-- ObtÃ©m e-mails secundÃ¡rios
get_secondary_emails(emails_json jsonb) returns jsonb
```

### View Helper

```sql
create view customer_with_emails as
select 
  c.*,
  get_primary_email(c.emails) as primary_email,
  jsonb_array_length(c.emails) - 1 as additional_emails_count
from customer c;
```

---

## ğŸ“ Arquivos Criados/Modificados

### Novos Arquivos

1. **`lib/utils/tax-id-types.ts`**
   - Mapeamento de tipos de identificaÃ§Ã£o fiscal por paÃ­s
   - FunÃ§Ãµes helper para obter tipos disponÃ­veis
   - DescriÃ§Ãµes detalhadas de cada tipo

2. **`components/MultiEmailInput.tsx`**
   - Componente para gerenciar mÃºltiplos e-mails
   - ValidaÃ§Ã£o automÃ¡tica
   - Interface intuitiva
   - Hook `useMultiEmail` para gerenciar estado

3. **`lib/supabase/migrations/09_add_emails_to_customer.sql`**
   - Adiciona campo `emails` (JSONB)
   - FunÃ§Ãµes de validaÃ§Ã£o e helpers
   - View `customer_with_emails`

### Arquivos Modificados

1. **`components/CustomerForm.tsx`**
   - IntegraÃ§Ã£o com lista completa de paÃ­ses
   - Select dinÃ¢mico de identificaÃ§Ã£o fiscal
   - Componente de mÃºltiplos e-mails
   - OrganizaÃ§Ã£o em seÃ§Ãµes
   - Design moderno

2. **`types/customer.ts`**
   - Adicionado campo `emails: string[]`
   - Atualizado `tax_id_type` para string (mais flexÃ­vel)

3. **`modules/customers/service.ts`**
   - Suporte a mÃºltiplos e-mails
   - MigraÃ§Ã£o automÃ¡tica do e-mail Ãºnico para array

---

## ğŸš€ Como Usar

### 1. Aplicar Migration 09

```sql
-- No Supabase SQL Editor
-- Cole o conteÃºdo de: lib/supabase/migrations/09_add_emails_to_customer.sql
```

### 2. Cadastrar Cliente com MÃºltiplos E-mails

```typescript
// No formulÃ¡rio
const handleSubmit = async (data) => {
  await createCustomer({
    legal_name: 'Acme Corp',
    country_code: 'BR',
    emails: [
      'financeiro@acme.com',    // Principal
      'contabilidade@acme.com', // SecundÃ¡rio
      'diretoria@acme.com'      // SecundÃ¡rio
    ],
    // ... outros campos
  })
}
```

### 3. Enviar Fatura para Todos os E-mails

```typescript
// Ao gerar fatura
const customer = await getCustomerById(customerId)

// Enviar para todos os e-mails
for (const email of customer.emails) {
  await sendInvoiceEmail(invoice, email)
}

// Ou apenas para o principal
const primaryEmail = customer.emails[0]
await sendInvoiceEmail(invoice, primaryEmail)
```

---

## ğŸ’¡ Exemplos de Uso

### Exemplo 1: Cliente Brasileiro

```typescript
{
  legal_name: 'Empresa Brasileira Ltda',
  trade_name: 'Empresa BR',
  country_code: 'BR',
  tax_id_type: 'CNPJ',
  tax_id: '12.345.678/0001-90',
  emails: [
    'financeiro@empresa.com.br',
    'contabilidade@empresa.com.br'
  ],
  phone: '+5511987654321',
  phone_country: 'BR',
  preferred_language: 'pt-BR'
}
```

### Exemplo 2: Cliente Americano

```typescript
{
  legal_name: 'American Company Inc',
  country_code: 'US',
  tax_id_type: 'EIN',
  tax_id: '12-3456789',
  emails: [
    'accounting@company.com',
    'finance@company.com',
    'cfo@company.com'
  ],
  phone: '+12345678900',
  phone_country: 'US',
  preferred_language: 'en-US'
}
```

### Exemplo 3: Cliente Espanhol

```typescript
{
  legal_name: 'Empresa EspaÃ±ola S.L.',
  country_code: 'ES',
  tax_id_type: 'NIF',
  tax_id: 'B12345678',
  emails: [
    'administracion@empresa.es',
    'contabilidad@empresa.es'
  ],
  phone: '+34612345678',
  phone_country: 'ES',
  preferred_language: 'es-ES'
}
```

---

## ğŸ¯ BenefÃ­cios

### Para o UsuÃ¡rio
- âœ… **Mais flexibilidade** ao cadastrar clientes
- âœ… **Interface intuitiva** e fÃ¡cil de usar
- âœ… **Menos erros** com validaÃ§Ã£o automÃ¡tica
- âœ… **Mais profissional** com tipos de documentos corretos por paÃ­s

### Para o Sistema
- âœ… **Envio automÃ¡tico** de faturas para mÃºltiplos destinatÃ¡rios
- âœ… **Dados mais precisos** com validaÃ§Ã£o por paÃ­s
- âœ… **Melhor organizaÃ§Ã£o** com campos estruturados
- âœ… **Preparado para crescimento** internacional

### Para o Futuro
- âœ… **IntegraÃ§Ã£o com APIs** de envio de e-mail
- âœ… **AutomaÃ§Ã£o** de comunicaÃ§Ãµes
- âœ… **RelatÃ³rios** enviados automaticamente
- âœ… **NotificaÃ§Ãµes** para mÃºltiplos contatos

---

## ğŸ” ValidaÃ§Ãµes Implementadas

### E-mails
- âœ… Formato vÃ¡lido de e-mail
- âœ… Sem duplicatas
- âœ… Limite de 5 e-mails
- âœ… Pelo menos 1 e-mail obrigatÃ³rio

### IdentificaÃ§Ã£o Fiscal
- âœ… Tipos disponÃ­veis baseados no paÃ­s
- âœ… DescriÃ§Ã£o clara de cada tipo
- âœ… AtualizaÃ§Ã£o automÃ¡tica ao mudar paÃ­s

### Telefone
- âœ… Formato internacional E.164
- âœ… PaÃ­s do telefone independente do paÃ­s da empresa
- âœ… ValidaÃ§Ã£o em tempo real

---

## ğŸ“Š EstatÃ­sticas

- **104 paÃ­ses** suportados
- **50+ tipos** de identificaÃ§Ã£o fiscal
- **5 e-mails** por cliente
- **3 idiomas** suportados (pt-BR, es-ES, en-US)
- **4 seÃ§Ãµes** organizadas no formulÃ¡rio

---

## ğŸ”œ PrÃ³ximos Passos

1. âœ… Aplicar Migration 09
2. âœ… Testar cadastro de clientes
3. âœ… Verificar validaÃ§Ãµes
4. ğŸ”œ Implementar envio automÃ¡tico de faturas
5. ğŸ”œ Adicionar templates de e-mail
6. ğŸ”œ Dashboard de comunicaÃ§Ãµes

---

**Data de CriaÃ§Ã£o**: 2025-11-01  
**VersÃ£o**: 2.0.0  
**Autor**: Sistema de GestÃ£o Yve Beauty

